# SSH Config Editor - ユーザーマニュアル

## 目次

1. [概要](#概要)
2. [インストールと起動](#インストールと起動)
3. [画面構成](#画面構成)
4. [基本操作](#基本操作)
5. [グループ管理](#グループ管理)
6. [SSH Config ファイルの仕様](#ssh-config-ファイルの仕様)
7. [よくある質問](#よくある質問)

---

## 概要

SSH Config Editor は、SSH接続設定ファイル（`~/.ssh/config`）を視覚的に編集できるGUIアプリケーションです。

### 主な機能

- **視覚的な編集** - テキストエディタではなく、フォーム形式でSSH設定を編集
- **検索・フィルタリング** - ホスト名、タグ、プロパティをリアルタイムに検索
  - 複数キーワード検索（スペース区切りでAND検索）
  - デバウンス処理による高速な検索
- **折りたたみ表示** - 多数のホスト設定がある場合でも、必要な設定だけを展開して表示
  - すべて展開/すべて折りたたむ機能
- **グループ管理** - ホストをグループに分類して整理
- **ドラッグ&ドロップ** - ホストの表示順序やグループ間の移動が自由自在
- **タグサポート** - ホストに説明コメントを追加
- **有効/無効の切り替え** - ホスト設定を削除せずに一時的に無効化
- **複数値対応** - LocalForward、IdentityFileなど複数指定可能なプロパティをサポート
- **プロパティ入力補助** - 一般的なSSHプロパティのドロップダウンリストから選択可能
- **自動フォーマット** - 保存時に適切なインデントと間隔で整形
- **自動バックアップ** - 保存前に元のファイルを自動的にバックアップ
- **スマートスクロール** - 新規作成したホストやグループに自動的にスクロール

---

## インストールと起動

### インストール方法

配布ファイルには2種類あります：

#### 1. インストーラー版（推奨）

`SSH Config Editor Setup 1.0.0.exe` をダブルクリックしてインストールします。

- インストールウィザードに従ってインストール先を選択
- デスクトップにショートカットが作成されます
- スタートメニューから起動可能
- アンインストーラーが自動的にインストールされます

#### 2. ポータブル版

`SSH Config Editor 1.0.0.exe` をダブルクリックして起動します。

- インストール不要で即座に使用可能
- USBメモリなどで持ち運び可能
- レジストリを使用しません

### 初回起動時の動作

アプリケーションは起動時に `C:\Users\<ユーザー名>\.ssh\config` ファイルを自動的に読み込みます。

- ファイルが存在しない場合、「SSH config file not found. A new file will be created when you save.」というメッセージが表示され、空の状態で起動します
- ファイルが存在する場合、その内容が画面に表示されます

---

## 画面構成

### ヘッダー部分

画面上部には以下の要素があります：

- **SSH Config Editor** - アプリケーションタイトル
- **Reload** ボタン - ファイルを再読み込み（編集中の変更は破棄されます）
- **Save** ボタン - 変更を保存（変更がある場合は `Save *` と表示されます）

### ツールバー

ホスト一覧の上部にあります：

- **+ New Host** ボタン - 新しいホスト設定を追加
- **+ New Group** ボタン - 新しいグループを作成
- **Expand All** ボタン - すべてのホスト設定を展開
- **Collapse All** ボタン - すべてのホスト設定を折りたたむ
- **ホスト数表示** - 現在の設定ホスト数（例：「5 hosts」）

### 検索ボックス

ツールバーの下にあります：

- **検索入力欄** - ホスト名、タグ、プロパティのキーや値で検索
  - 入力すると即座にフィルタリングされます（300msのデバウンス処理）
  - スペースで区切ると複数キーワードでAND検索
  - 例：「prod server」と入力すると、「prod」と「server」の両方を含むホストのみ表示
- **× ボタン** - 検索をクリアしてすべてのホストを表示

### グループ表示

グループは以下のように表示されます：

```
#$ Production Servers        3 hosts  [Rename] [Delete]
```

- **#$** - グループマーカー
- **Production Servers** - グループ名
- **3 hosts** - グループに含まれるホスト数
- **Rename** - グループ名を変更
- **Delete** - グループを削除（ホストはungroupedに移動）

### ホスト一覧

各ホスト設定は折りたたみ可能なカードとして表示されます：

```
⋮⋮ ▾ dev-server
     # Production server
```

- **⋮⋮** - ドラッグハンドル（これを掴んでドラッグすると並び順を変更したり、グループに移動できます）
- **▾/▸** - 折りたたみアイコン（クリックで展開/折りたたみ）
- **dev-server** - ホストパターン名
- **# Production server** - タグ（ホストの説明コメント）
- **# Host** - 無効化されたホストには `#` が先頭に表示されます

---

## 基本操作

### 1. ホスト設定の追加

1. **+ New Host** ボタンをクリック
2. 新しいホスト設定カードが一番下に追加されます（初期値：`new-host`）
3. 画面は自動的に新しいホストまでスクロールします
4. カードをクリックして展開し、**Edit** ボタンをクリック
5. 各項目を入力します：
   - **Host Pattern** - ホストパターン名（必須）
   - **Tag** - ホストの説明コメント（任意）
   - **HostName** - 接続先サーバーのIPアドレスまたはホスト名
   - **User** - ログインユーザー名
   - **Port** - ポート番号（デフォルト：22）
   - その他の設定項目
6. **Save** ボタンをクリックして編集を確定
7. 画面上部の **Save** ボタンをクリックしてファイルに保存

### 2. ホスト設定の表示/非表示

ホストカードのヘッダー部分をクリックすると、設定内容の表示/非表示を切り替えられます。

- **▾** - 展開状態（設定内容が表示されます）
- **▸** - 折りたたみ状態（ホスト名とタグのみ表示）

### 3. ホスト設定の編集

1. 編集したいホストカードを展開
2. **Edit** ボタンをクリック
3. 編集フォームで各項目を変更：
   - テキストボックスに直接入力
   - **Tag** フィールドでホストの説明を追加・編集
   - **+ Add Property** で新しいプロパティを追加
   - **Remove** で不要なプロパティを削除
4. **Save** ボタンで編集を確定、または **Cancel** で取り消し
5. 画面上部の **Save** ボタンでファイルに保存

### 4. タグの追加

タグは、ホストの説明や用途を記録するためのコメントです：

1. ホストの編集モードで **Tag** フィールドに入力
2. 例：「本番サーバー」「開発環境」「テスト用」など
3. タグはホスト名の下に表示されます
4. ファイルに保存すると、`Host` 行の直前にコメントとして記録されます

### 5. プロパティの追加（カスタムプロパティ）

編集モード中に、デフォルトで表示されていないSSHプロパティを追加できます：

1. 編集モードの下部にある **Add Property** セクションに移動
2. **Property Key** 入力欄をクリックまたは入力開始
   - 一般的なSSHプロパティのドロップダウンリストが表示されます
   - リストから選択するか、キーボードで入力してオートコンプリート
   - リストにないカスタムプロパティも自由に入力可能
3. 例：ドロップダウンリストから選択
   - `ServerAliveInterval`, `StrictHostKeyChecking`, `ProxyCommand` など
4. **Property Value** に値を入力（例：`60`）
5. **Add** ボタンをクリック

**利用可能なプロパティの例：**
- `ServerAliveInterval` - サーバーへの生存確認間隔
- `ServerAliveCountMax` - 生存確認の最大回数
- `StrictHostKeyChecking` - ホストキー検証の厳格性
- `Compression` - 圧縮の有効化
- `ControlMaster` / `ControlPath` / `ControlPersist` - 接続の多重化
- その他50種類以上の一般的なSSHプロパティ

### 6. 複数値プロパティの追加

以下のプロパティは複数の値を指定できます：

- **LocalForward**
- **RemoteForward**
- **DynamicForward**
- **IdentityFile**
- **SendEnv**
- **SetEnv**
- **CertificateFile**
- **CanonicalDomains**

編集モードで：

1. プロパティの右側にある **+ Add value** ボタンをクリック
2. 新しい入力フィールドが追加されます
3. 各フィールドに値を入力
4. **Remove** で個別の値を削除できます

**LocalForward/RemoteForward/DynamicForward の特別機能：**

これらのプロパティは個別に有効/無効を切り替えられます：

- **Enabled** ボタン（緑）- 現在有効な設定
- **Disabled** ボタン（赤）- 現在無効な設定
- ボタンをクリックで切り替え

### 7. ホスト設定の並び替え

#### 同じグループ内での並び替え

1. ホストカードの **⋮⋮** アイコンをドラッグ
2. 同じグループ内の目的の位置にドロップ
3. 画面上部の **Save** ボタンで保存すると、ファイル内の順序も変更されます

#### グループ間の移動

1. ホストカードの **⋮⋮** アイコンをドラッグ
2. 別のグループのドロップエリアにドラッグ
3. グループエリアが青くハイライトされたらドロップ
4. ホストが新しいグループに移動します

**ヒント：** 展開されたホストカードは高さが大きいため、折りたたんでからドラッグするとドロップしやすくなります。

### 8. ホスト設定の複製

同じような設定のホストを作成する場合に便利です：

1. 複製元のホストカードを展開
2. **Duplicate** ボタンをクリック
3. 複製されたホスト設定が元のホストの直後に追加されます（名前とタグに `-copy` が付きます）
4. 必要に応じて編集し、保存します

### 9. ホスト設定の有効化/無効化

ホストを削除せずに一時的に無効化できます：

1. ホストカードを展開
2. **Enable/Disable** ボタンをクリック
3. 無効化されたホストは以下のようになります：
   - カードが半透明表示
   - ホスト名の前に `#` が表示
   - ファイル保存時にコメントアウトされます
4. ホストを無効化すると、すべてのプロパティも同時に無効化されます

再度 **Enable** ボタンをクリックすると、ホストとすべてのプロパティが有効に戻ります。

### 10. ホスト設定の削除

1. 削除したいホストカードを展開
2. **Delete** ボタンをクリック
3. 確認ダイアログで **OK** をクリック
4. 画面上部の **Save** ボタンで保存すると、ファイルからも削除されます

### 11. ファイルの保存

変更を加えた後：

1. 画面上部の **Save** ボタンをクリック
2. 保存が成功すると、成功メッセージが表示され、`Save` ボタンから `*` マークが消えます
3. 保存前に自動的にバックアップファイルが作成されます：
   - ファイル名：`.ssh/config.backup.YYYYMMDD_HHMMSS`
   - 例：`config.backup.20250131_143045`
   - 最新の5つのバックアップのみが保持されます

### 12. ファイルの再読み込み

編集中の変更を破棄して、ファイルから再読み込みする場合：

1. **Reload** ボタンをクリック
2. 未保存の変更がある場合、確認ダイアログが表示されます
3. **OK** をクリックするとファイルが再度読み込まれ、編集中の変更は失われます

### 13. ホスト設定の検索

多数のホスト設定がある場合、検索機能を使用して素早く目的のホストを見つけられます：

#### 基本的な検索

1. ツールバー下の検索ボックスにキーワードを入力
2. 入力すると自動的にフィルタリングが実行されます（300msのデバウンス処理）
3. 検索対象：
   - ホストパターン名（Host）
   - タグ（説明コメント）
   - プロパティのキー名（HostName、User、Port など）
   - プロパティの値（IPアドレス、ユーザー名など）

#### 複数キーワード検索

スペースで区切って複数のキーワードを入力すると、AND条件で検索できます：

**例：**
- `prod server` と入力 → 「prod」と「server」の両方を含むホストのみ表示
- `192.168 user` と入力 → 「192.168」と「user」の両方を含むホストのみ表示

#### 検索のクリア

- 検索ボックス右側の **×** ボタンをクリック
- または検索ボックスの文字を削除

#### 検索結果が0件の場合

「No hosts found matching your search.」というメッセージが表示されます。

### 14. すべて展開/すべて折りたたむ

多数のホスト設定を一括で展開または折りたたむことができます：

#### すべて展開

1. ツールバーの **Expand All** ボタンをクリック
2. すべてのホスト設定が展開され、プロパティが表示されます

#### すべて折りたたむ

1. ツールバーの **Collapse All** ボタンをクリック
2. すべてのホスト設定が折りたたまれ、ホスト名とタグのみ表示されます

**ヒント：** 特定のホストだけを詳しく見たい場合は、まず「Collapse All」で全体を折りたたんでから、目的のホストだけを展開すると便利です。

---

## グループ管理

グループ機能を使用すると、多数のホストを論理的に整理できます。

### グループの作成

1. **+ New Group** ボタンをクリック
2. 新しいグループが作成されます（初期名：「New Group」）
3. 画面は自動的に新しいグループまでスクロールします
4. グループ名を変更するには **Rename** ボタンをクリック

### グループ名の変更

1. グループヘッダーの **Rename** ボタンをクリック
2. テキストフィールドにグループ名を入力
3. **Enter** キーで確定、または **Escape** キーでキャンセル
4. **Save** ボタンで編集を確定、または **Cancel** で取り消し

### グループへのホストの追加

#### 方法1: ドラッグ&ドロップ

1. ホストカードの **⋮⋮** アイコンをドラッグ
2. グループのドロップエリア（破線の枠）にドラッグ
3. エリアが青くハイライトされたらドロップ
4. ホストがグループに追加されます

#### 方法2: 新規ホストを直接グループに追加

1. グループ内のドロップエリアにホストをドラッグ
2. または、ホストを追加後にグループにドラッグ

### グループからホストを削除

1. グループ内のホストをドラッグ
2. 「ungrouped」エリア（画面下部）にドロップ
3. ホストがグループから削除され、ungroupedに移動します

### グループの削除

1. グループヘッダーの **Delete** ボタンをクリック
2. 確認ダイアログが表示されます：「Delete group "グループ名"? All hosts will be moved to ungrouped.」
3. **OK** をクリックするとグループが削除されます
4. グループ内のすべてのホストは ungrouped に移動します
5. 画面上部の **Save** ボタンで保存してください

### グループの表示順序

- グループはファイル内の出現順に表示されます
- 現在のバージョンではグループ自体の並び替えはサポートされていません
- グループ内のホストの順序は自由に変更できます

### ungrouped エリア

- グループに属していないホストは「ungrouped」として画面下部に表示されます
- ungrouped エリアにもホストをドラッグ&ドロップできます
- ungrouped はファイルに保存されません（グループマーカーがないホスト）

---

## SSH Config ファイルの仕様

### ファイルの場所

- **Windows:** `C:\Users\<ユーザー名>\.ssh\config`
- このファイルがSSH接続時に自動的に参照されます

### ファイル形式

SSH Config ファイルは以下の形式で記述されます：

```
# タグコメント
Host ホストパターン名
    プロパティ名 値
    プロパティ名 値
    ...

#$ グループ名
Host グループ内のホスト1
    プロパティ名 値
    ...

Host グループ内のホスト2
    プロパティ名 値
    ...
```

### グループマーカー（#$）

`#$` で始まる行は、グループの開始を示します：

```
#$ Production Servers
Host prod-1
    HostName 10.0.1.10
    User admin

Host prod-2
    HostName 10.0.1.11
    User admin

#$ Development Servers
Host dev-1
    HostName 192.168.1.10
    User developer
```

- `#$ Production Servers` 以降、次のグループマーカーまでのホストが「Production Servers」グループに属します
- グループマーカーは SSH の接続動作には影響しません（単なるコメント）
- アプリケーション内でグループとして表示・管理されます

### 入力例

以下は、アプリケーションで作成できる設定の例です。

#### 基本的な設定（タグ付き）

```
# Development server for testing
Host dev-server
    HostName 192.168.1.10
    User developer
    Port 22
    IdentityFile ~/.ssh/id_rsa
    ForwardAgent yes
```

この設定により、`ssh dev-server` コマンドで以下のように接続されます：
- 接続先：192.168.1.10:22
- ユーザー名：developer
- 秘密鍵：~/.ssh/id_rsa
- エージェント転送：有効

#### グループ化された設定

```
#$ Production Servers
# Main production server
Host prod-web
    HostName prod.example.com
    User admin
    Port 22
    IdentityFile ~/.ssh/id_rsa_prod

# Database server
Host prod-db
    HostName db.example.com
    User dbadmin
    Port 22
    IdentityFile ~/.ssh/id_rsa_prod

#$ Development Servers
# Development web server
Host dev-web
    HostName dev.local
    User developer
    Port 22
```

#### 踏み台サーバー経由の接続

```
#$ Production Environment
Host prod-server
    HostName 10.0.0.50
    User admin
    Port 22
    ProxyJump bastion
    IdentityFile ~/.ssh/id_rsa_prod

# Bastion host
Host bastion
    HostName bastion.example.com
    User jumpuser
    Port 2222
    IdentityFile ~/.ssh/id_rsa_bastion
```

`ssh prod-server` で bastion サーバー経由で prod-server に接続します。

#### ポートフォワーディング設定

```
# Development server with port forwarding
Host dev-server
    HostName 192.168.1.10
    User developer
    Port 22
    LocalForward 8080 localhost:8080
    LocalForward 3000 localhost:3000
    RemoteForward 9000 localhost:9000
```

- LocalForward：ローカルの8080番ポートをサーバーの8080番ポートに転送
- LocalForward：ローカルの3000番ポートをサーバーの3000番ポートに転送
- RemoteForward：サーバーの9000番ポートをローカルの9000番ポートに転送

#### 無効化されたホスト設定

```
# Old server (disabled)
#Host old-server
#    HostName 192.168.1.50
#    User admin
#    Port 22

# Current server
Host new-server
    HostName 192.168.1.51
    User admin
    Port 22
```

`old-server` は無効化されており、SSH接続時には認識されません。アプリケーションでは「Disabled」状態として表示されます。

#### 一部のポートフォワーディングを無効化

```
Host dev-server
    HostName 192.168.1.10
    User developer
    Port 22
    LocalForward 8080 localhost:8080
    LocalForward 3000 localhost:3000
#    LocalForward 5432 localhost:5432
```

3つ目の LocalForward（5432番ポート）のみが無効化されています。

### 出力形式

アプリケーションでファイルを保存すると、以下の規則で自動的にフォーマットされます：

1. **グループマーカー** - `#$` で始まり、行頭から開始
2. **タグコメント** - `#` で始まり、Host の直前に配置
3. **Host ディレクティブ** - 行頭から開始（インデントなし）
4. **プロパティ** - Host の下に4スペースでインデント
5. **空行** - 各ホスト設定の間に1行の空行を挿入
6. **無効化されたホスト** - 全ての行がコメントアウトされます

### サポートされる主なSSHプロパティ

アプリケーションでは以下のSSHプロパティを編集できます：

| プロパティ名 | 説明 | 複数値 | 個別有効化 |
|------------|------|-------|----------|
| Host | ホストパターン（必須） | - | - |
| Tag | ホストの説明コメント | - | - |
| HostName | 接続先のホスト名またはIPアドレス | - | - |
| User | ログインユーザー名 | - | - |
| Port | ポート番号（デフォルト：22） | - | - |
| IdentityFile | 秘密鍵ファイルのパス | ✓ | - |
| ProxyJump | 踏み台サーバー | - | - |
| ForwardAgent | エージェント転送の有効化（yes/no） | - | - |
| LocalForward | ローカルポートフォワーディング | ✓ | ✓ |
| RemoteForward | リモートポートフォワーディング | ✓ | ✓ |
| DynamicForward | 動的ポートフォワーディング | ✓ | ✓ |
| SendEnv | サーバーに送信する環境変数 | ✓ | - |
| SetEnv | 環境変数の設定 | ✓ | - |
| CertificateFile | 証明書ファイル | ✓ | - |
| CanonicalDomains | 正規ドメイン | ✓ | - |

**カスタムプロパティ：** 上記以外のSSHプロパティも「+ Add Property」機能で追加できます。
- 例：`ServerAliveInterval`, `StrictHostKeyChecking`, `ProxyCommand` など

---

## よくある質問

### Q1. 編集した内容はいつファイルに保存されますか？

画面上部の **Save** ボタンをクリックするまで、実際のファイルには保存されません。変更がある場合、ボタンに `*` マークが表示されます。

### Q2. 元のファイルに戻したい場合はどうすればよいですか？

保存時に自動的に作成されるバックアップファイルから復元できます：

1. エクスプローラーで `C:\Users\<ユーザー名>\.ssh\` フォルダを開く
2. `config.backup.YYYYMMDD_HHMMSS` ファイルを探す（最新のものを選択）
3. このファイルを `config` にリネームして復元

または、アプリケーション内で **Reload** ボタンをクリックすると、未保存の変更を破棄してファイルから再読み込みします。

### Q3. グループを削除すると、中のホストも削除されますか？

いいえ、グループを削除しても、グループ内のホストは削除されません。すべてのホストは「ungrouped」エリアに移動します。ホストの設定内容は保持されます。

### Q4. 編集した設定はすぐにSSH接続に反映されますか？

はい、ファイルを保存後、次回のSSH接続から新しい設定が使用されます。既に接続中のSSHセッションには影響しません。

### Q5. グループはSSHの接続動作に影響しますか？

いいえ、グループマーカー（`#$`）は単なるコメントであり、SSH の接続動作には一切影響しません。グループはこのアプリケーション内で設定を整理するためだけに使用されます。

### Q6. 複数のConfigファイルを編集できますか？

現在のバージョンでは、ユーザーのホームディレクトリ配下の `.ssh/config` のみが対象です。他の場所にあるConfigファイルを編集することはできません。

### Q7. ドラッグ&ドロップがうまくいかない場合は？

展開されたホストカードは高さが大きいため、ドロップエリアからはみ出してしまう場合があります。以下を試してください：

1. ホストカードを折りたたんでからドラッグ
2. ドラッグ中は、マウスポインタがドロップエリア内にあることを確認
3. ドロップエリアが青くハイライトされたらドロップ

### Q8. ワイルドカード（*）を使ったHost設定は作成できますか？

はい、Host Pattern フィールドにワイルドカードを含むパターンを入力できます。

例：
- `*.example.com` - example.com の全てのサブドメイン
- `192.168.1.*` - 192.168.1.x の全てのIPアドレス

### Q9. 保存時にエラーが発生した場合はどうなりますか？

エラーダイアログが表示され、ファイルは保存されません。以下を確認してください：

- ファイルが他のアプリケーションで開かれていないか
- `.ssh` フォルダの書き込み権限があるか
- ディスク容量が十分にあるか

### Q10. アプリケーションを複数起動できますか？

技術的には可能ですが、同じファイルを複数のウィンドウで編集すると、後から保存した内容で上書きされます。推奨しません。

### Q11. 無効化したホストは完全に削除されますか？

いいえ、無効化されたホストはファイル内でコメントアウトされた状態で保存されます。いつでも **Enable** ボタンで有効に戻せます。完全に削除したい場合は **Delete** ボタンを使用してください。

### Q12. 手動でテキストエディタで編集したファイルも読み込めますか？

はい、標準的なSSH Config形式で記述されていれば、手動で編集したファイルも正しく読み込めます。グループマーカー（`#$`）やタグコメントも認識されます。

### Q13. ファイル内のコメントは保持されますか？

はい、以下のコメントは保持されます：
- タグコメント（Host の直前にあるコメント）
- グループマーカー（`#$` で始まるコメント）
- 無効化されたホストのコメント

ただし、ホストブロック内の任意の位置にあるコメントは、保存時に削除される場合があります。

### Q14. バックアップファイルはいつまで保持されますか？

最新の5つのバックアップファイルのみが自動的に保持されます。古いバックアップは自動的に削除されます。重要な設定は手動で別の場所にバックアップすることをお勧めします。
